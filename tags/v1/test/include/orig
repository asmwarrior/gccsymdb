PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE ProjectOverview (
	dbVersion text,
	gccVersion text,
	projectRootPath text,
	-- plugin control parameters.
	debug boolean
);
INSERT INTO "ProjectOverview" VALUES('1.0','4.6.2','/home/zyf/src/symdb.gcc','true');
CREATE TABLE chFile (
	id integer primary key autoincrement,
	fullName text, -- absolute path.
	mtime bigint,
	sysHeader boolean
);
INSERT INTO "chFile" VALUES(1,'/home/zyf/src/symdb.gcc/test/include/a.c',1319683105,'false');
INSERT INTO "chFile" VALUES(2,'/home/zyf/src/symdb.gcc/test/include/a.h',1319683105,'false');
CREATE TABLE iFile (
	id integer primary key autoincrement,
	mainFileID integer, -- chFile::id.
	hasError integer, -- 0: no error; 1: c preprocess stage error; 2: c/c++ error.
	iTokenStartID bigint,
	iTokenEndID bigint,
	syntaxTreeStartID bigint,
	syntaxTreeEndID bigint
);
INSERT INTO "iFile" VALUES(1,1,0,2,73,0,0);
CREATE TABLE FileDependence (
	id integer primary key autoincrement,
	iFileID integer,
	hID integer
);
INSERT INTO "FileDependence" VALUES(1,1,1);
INSERT INTO "FileDependence" VALUES(2,1,2);
CREATE TABLE chToken (
	id integer primary key autoincrement,
	flag integer, -- see symdb document
	length integer,
	chFileID integer,
	fileOffset integer
);
INSERT INTO "chToken" VALUES(1,50340917,3,1,0);
INSERT INTO "chToken" VALUES(2,50331701,1,1,4);
INSERT INTO "chToken" VALUES(3,50331667,1,1,5);
INSERT INTO "chToken" VALUES(4,50331701,1,1,7);
INSERT INTO "chToken" VALUES(5,50331667,1,1,8);
INSERT INTO "chToken" VALUES(6,50331701,2,1,10);
INSERT INTO "chToken" VALUES(7,50331691,1,1,12);
INSERT INTO "chToken" VALUES(8,50341941,4,1,14);
INSERT INTO "chToken" VALUES(9,50331701,3,1,19);
INSERT INTO "chToken" VALUES(10,50331668,1,1,22);
INSERT INTO "chToken" VALUES(11,50341941,4,1,23);
INSERT INTO "chToken" VALUES(12,50331669,1,1,27);
INSERT INTO "chToken" VALUES(13,50331689,1,1,29);
INSERT INTO "chToken" VALUES(14,33554469,1,1,31);
INSERT INTO "chToken" VALUES(15,33554485,6,1,32);
INSERT INTO "chToken" VALUES(16,33554485,1,1,39);
INSERT INTO "chToken" VALUES(17,33554487,1,1,44);
INSERT INTO "chToken" VALUES(18,33554475,1,1,45);
INSERT INTO "chToken" VALUES(19,33554469,1,1,47);
INSERT INTO "chToken" VALUES(20,33554485,7,1,48);
INSERT INTO "chToken" VALUES(21,33554493,5,1,56);
INSERT INTO "chToken" VALUES(22,50331701,1,2,0);
INSERT INTO "chToken" VALUES(23,50331648,1,2,2);
INSERT INTO "chToken" VALUES(24,16777269,1,2,4);
INSERT INTO "chToken" VALUES(25,50331691,1,2,5);
INSERT INTO "chToken" VALUES(26,33554469,1,1,62);
INSERT INTO "chToken" VALUES(27,33554485,5,1,63);
INSERT INTO "chToken" VALUES(28,33554485,1,1,69);
INSERT INTO "chToken" VALUES(29,33554469,1,1,72);
INSERT INTO "chToken" VALUES(30,33554485,6,1,73);
INSERT INTO "chToken" VALUES(31,33554485,1,1,80);
INSERT INTO "chToken" VALUES(32,33554485,1,1,85);
INSERT INTO "chToken" VALUES(33,33554436,1,1,87);
INSERT INTO "chToken" VALUES(34,33554485,2,1,89);
INSERT INTO "chToken" VALUES(35,33554475,1,1,91);
INSERT INTO "chToken" VALUES(36,33554469,1,1,93);
INSERT INTO "chToken" VALUES(37,33554485,7,1,94);
INSERT INTO "chToken" VALUES(38,33554493,5,1,102);
INSERT INTO "chToken" VALUES(39,33554469,1,1,108);
INSERT INTO "chToken" VALUES(40,33554485,5,1,109);
INSERT INTO "chToken" VALUES(41,33554485,1,1,115);
INSERT INTO "chToken" VALUES(42,33554469,1,1,118);
INSERT INTO "chToken" VALUES(43,33554485,6,1,119);
INSERT INTO "chToken" VALUES(44,33554485,1,1,126);
INSERT INTO "chToken" VALUES(45,33554485,2,1,131);
INSERT INTO "chToken" VALUES(46,33554469,1,1,134);
INSERT INTO "chToken" VALUES(47,33554485,6,1,135);
INSERT INTO "chToken" VALUES(48,33554485,1,1,142);
INSERT INTO "chToken" VALUES(49,33554487,1,1,147);
INSERT INTO "chToken" VALUES(50,33554475,1,1,148);
INSERT INTO "chToken" VALUES(51,33554469,1,1,150);
INSERT INTO "chToken" VALUES(52,33554485,7,1,151);
INSERT INTO "chToken" VALUES(53,33554493,5,1,159);
INSERT INTO "chToken" VALUES(54,16777269,1,2,0);
INSERT INTO "chToken" VALUES(55,50331690,1,1,165);
CREATE TABLE MacroDescription (
	id integer primary key autoincrement,
	leaderchTokenID bigint,
	expandedCount integer,
	macroCount integer,
	macroStartID bigint
);
INSERT INTO "MacroDescription" VALUES(1,24,1,2,1);
INSERT INTO "MacroDescription" VALUES(2,24,1,4,3);
INSERT INTO "MacroDescription" VALUES(3,54,1,1,7);
INSERT INTO "MacroDescription" VALUES(4,24,1,2,8);
CREATE TABLE MacroToken (
	id integer primary key autoincrement,
	flag, -- see symdb document
	value text
);
INSERT INTO "MacroToken" VALUES(1,67108919,'2');
INSERT INTO "MacroToken" VALUES(2,67108907,';');
INSERT INTO "MacroToken" VALUES(3,67108917,'x');
INSERT INTO "MacroToken" VALUES(4,67108868,'+');
INSERT INTO "MacroToken" VALUES(5,67108917,'xx');
INSERT INTO "MacroToken" VALUES(6,67108907,';');
INSERT INTO "MacroToken" VALUES(7,67108917,'xx');
INSERT INTO "MacroToken" VALUES(8,67108919,'9');
INSERT INTO "MacroToken" VALUES(9,67108907,';');
CREATE TABLE iToken (
	id integer primary key autoincrement,
	flag integer, -- see symdb document
	length integer,
	value text,
	relattedTokenID bigint -- chToken::id or MacroToken::id.
);
INSERT INTO "iToken" VALUES(1,NULL,NULL,NULL,NULL);
INSERT INTO "iToken" VALUES(2,50340917,3,'int',1);
INSERT INTO "iToken" VALUES(3,50331701,1,'x',2);
INSERT INTO "iToken" VALUES(4,50331667,1,',',3);
INSERT INTO "iToken" VALUES(5,50331701,1,'y',4);
INSERT INTO "iToken" VALUES(6,50331667,1,',',5);
INSERT INTO "iToken" VALUES(7,50331701,2,'xx',6);
INSERT INTO "iToken" VALUES(8,50331691,1,';',7);
INSERT INTO "iToken" VALUES(9,50341941,4,'void',8);
INSERT INTO "iToken" VALUES(10,50331701,3,'foo',9);
INSERT INTO "iToken" VALUES(11,50331668,1,'(',10);
INSERT INTO "iToken" VALUES(12,50341941,4,'void',11);
INSERT INTO "iToken" VALUES(13,50331669,1,')',12);
INSERT INTO "iToken" VALUES(14,50331689,1,'{',13);
INSERT INTO "iToken" VALUES(15,33554469,1,'#',14);
INSERT INTO "iToken" VALUES(16,33554485,6,'define',15);
INSERT INTO "iToken" VALUES(17,33554485,1,'y',16);
INSERT INTO "iToken" VALUES(18,33554487,1,'2',17);
INSERT INTO "iToken" VALUES(19,33554475,1,';',18);
INSERT INTO "iToken" VALUES(20,33554469,1,'#',19);
INSERT INTO "iToken" VALUES(21,33554485,7,'include',20);
INSERT INTO "iToken" VALUES(22,33554493,5,'"a.h"',21);
INSERT INTO "iToken" VALUES(23,50331701,1,'x',22);
INSERT INTO "iToken" VALUES(24,50331648,1,'=',23);
INSERT INTO "iToken" VALUES(25,16777269,1,'y',24);
INSERT INTO "iToken" VALUES(26,67108919,1,'2',1);
INSERT INTO "iToken" VALUES(27,67108907,1,';',2);
INSERT INTO "iToken" VALUES(28,50331691,1,';',25);
INSERT INTO "iToken" VALUES(29,33554469,1,'#',26);
INSERT INTO "iToken" VALUES(30,33554485,5,'undef',27);
INSERT INTO "iToken" VALUES(31,33554485,1,'y',28);
INSERT INTO "iToken" VALUES(32,33554469,1,'#',29);
INSERT INTO "iToken" VALUES(33,33554485,6,'define',30);
INSERT INTO "iToken" VALUES(34,33554485,1,'y',31);
INSERT INTO "iToken" VALUES(35,33554485,1,'x',32);
INSERT INTO "iToken" VALUES(36,33554436,1,'+',33);
INSERT INTO "iToken" VALUES(37,33554485,2,'xx',34);
INSERT INTO "iToken" VALUES(38,33554475,1,';',35);
INSERT INTO "iToken" VALUES(39,33554469,1,'#',36);
INSERT INTO "iToken" VALUES(40,33554485,7,'include',37);
INSERT INTO "iToken" VALUES(41,33554493,5,'"a.h"',38);
INSERT INTO "iToken" VALUES(42,50331701,1,'x',22);
INSERT INTO "iToken" VALUES(43,50331648,1,'=',23);
INSERT INTO "iToken" VALUES(44,16777269,1,'y',24);
INSERT INTO "iToken" VALUES(45,67108917,1,'x',3);
INSERT INTO "iToken" VALUES(46,67108868,1,'+',4);
INSERT INTO "iToken" VALUES(47,67108917,2,'xx',5);
INSERT INTO "iToken" VALUES(48,67108907,1,';',6);
INSERT INTO "iToken" VALUES(49,50331691,1,';',25);
INSERT INTO "iToken" VALUES(50,33554469,1,'#',39);
INSERT INTO "iToken" VALUES(51,33554485,5,'undef',40);
INSERT INTO "iToken" VALUES(52,33554485,1,'y',41);
INSERT INTO "iToken" VALUES(53,33554469,1,'#',42);
INSERT INTO "iToken" VALUES(54,33554485,6,'define',43);
INSERT INTO "iToken" VALUES(55,33554485,1,'x',44);
INSERT INTO "iToken" VALUES(56,33554485,2,'xx',45);
INSERT INTO "iToken" VALUES(57,33554469,1,'#',46);
INSERT INTO "iToken" VALUES(58,33554485,6,'define',47);
INSERT INTO "iToken" VALUES(59,33554485,1,'y',48);
INSERT INTO "iToken" VALUES(60,33554487,1,'9',49);
INSERT INTO "iToken" VALUES(61,33554475,1,';',50);
INSERT INTO "iToken" VALUES(62,33554469,1,'#',51);
INSERT INTO "iToken" VALUES(63,33554485,7,'include',52);
INSERT INTO "iToken" VALUES(64,33554493,5,'"a.h"',53);
INSERT INTO "iToken" VALUES(65,16777269,1,'x',54);
INSERT INTO "iToken" VALUES(66,67108917,2,'xx',7);
INSERT INTO "iToken" VALUES(67,50331648,1,'=',23);
INSERT INTO "iToken" VALUES(68,16777269,1,'y',24);
INSERT INTO "iToken" VALUES(69,67108919,1,'9',8);
INSERT INTO "iToken" VALUES(70,67108907,1,';',9);
INSERT INTO "iToken" VALUES(71,50331691,1,';',25);
INSERT INTO "iToken" VALUES(72,50331690,1,'}',55);
CREATE TABLE SyntaxTree (
	id integer primary key autoincrement,
	code integer,
	-- To compound-statement tree, store start/end treeID.
	-- To VAR_DECL, FUNCTION_DECL etc. value = SemanticTree::id.
	value blob,
	parentTreeID integer -- store relative treeID of compound-statement head.
);
CREATE TABLE CompountStatment (
	id integer primary key autoincrement,
	code integer,
	value integer,
	value2 integer,
	parentTreeID integer
);
CREATE TABLE SemanticTree (
	id integer primary key autoincrement,
	syntaxTreeID integer,
	scopeCPPTokenID integer,
	declCPPTokenID integer,
	tokenID integer -- chToken::id or MacroToken::id.
);
CREATE TABLE TemporaryTree (
	id integer primary key autoincrement,
	memAddr integer,
	code integer,
	value blob,
	parentTreeID integer
);
DELETE FROM sqlite_sequence;
INSERT INTO "sqlite_sequence" VALUES('iToken',72);
INSERT INTO "sqlite_sequence" VALUES('chFile',2);
INSERT INTO "sqlite_sequence" VALUES('iFile',1);
INSERT INTO "sqlite_sequence" VALUES('FileDependence',2);
INSERT INTO "sqlite_sequence" VALUES('chToken',55);
INSERT INTO "sqlite_sequence" VALUES('MacroDescription',4);
INSERT INTO "sqlite_sequence" VALUES('MacroToken',9);
CREATE VIEW CompileUnit as
select
	b.fullName as cFile, b.mtime as cTime, c.fullName as hFile, c.mtime as hTime
from
	iFile as a, chFile as b, chFile as c, FileDependence as d
where
	a.mainFileID = b.id and a.id = d.iFileID and c.id = d.hID;
CREATE INDEX FileName on chFile (fullName);
CREATE VIEW FileToken as
select * from
(
select
	f.id as fileID, fileOffset, t.id as tokenID, flag, length
from
	chFile f, chToken as t
where
	f.id = t.chFileID
order by
	fileID, fileOffset
) as x
left outer join
(
select
	a.id as tokenID, b.id as macroDescriptionID
from
	chToken as a, MacroDescription as b
where
	a.id = b.leaderchTokenID
) as y
on
	x.tokenID = y.tokenID;
CREATE INDEX indexTokenFromFile on chToken (chFileID, fileOffset asc);
CREATE INDEX indexMacroWeld on MacroDescription (leaderchTokenID);
CREATE TRIGGER deleteTokenFromFile delete on chToken
begin
	delete from MacroDescription where leaderchTokenID = old.id;
end;
CREATE TRIGGER deleteTokenFromFile2 delete on MacroDescription
begin
	delete from MacroToken where id >= old.macroStartID and id < old.macroStartID + old.macroCount;
end;
COMMIT;
